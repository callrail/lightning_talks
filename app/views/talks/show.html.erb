<%= currently_at 'Talk' %>

<header class='inset-header talk dark center'>
  <div class='container-fluid contain clearfix pad4x'>
    <%= next_talk @talk %>
    <%= previous_talk @talk %>
    <h1>
      <%= @talk.title %>
    </h1>
    <p class='lead quiet'>
      <%= @talk.description %>
    </p>
    <div>
      <div class='pad1x inline'>
        By
        <%= link_to @talk.user do %>
          <%= avatar_for @talk.user, width: 24, class: 'img-rounded', 
                         style: 'margin: 0 5px' %><%= @talk.user.full_name %>
        <% end %>
        <span>
          on <%= link_to @talk.meeting.title, @talk.meeting, class: 'quiet' %>
        </span>
      </div>
      <div class='inline pad1x keyline-left'>
        <%= category_for(@talk) %>
      </div>
    </div>
    <ul class='actions pin-bottomright'>
      <% if (DateTime.now < @talk.meeting.date && (signed_in? && current_user.id == @talk.user_id)) || current_user.admin? %>
        <li>
          <%= link_to 'Destroy', @talk,
                                 method: :delete, 
                                 data: { confirm: 'Are you sure?' }, 
                                 class: 'btn btn-danger' %>
        </li>
      <% end %>
      <% if current_user.admin? %>
        <li>
          <%= link_to 'Edit', edit_talk_path(@talk), class: 'btn btn-loud' %>
        </li>
      <% end %>
      <% if signed_in? && current_user.id == @talk.user.id %>
        <li>
          <%= link_to 'Edit', edit_talk_path(@talk), class: 'btn btn-primary' %>
        </li>
      <% end %>      
      <li>
        <a href='#comments' class='btn btn-default'>
          <i class='icon icon-comment quiet pad0r'></i><%= @comments.size %>
        </a>
      </li>
      <li>
        <%= render 'favorite_form' %>
      </li>
      <li>
        <a href='#fakelink' class='btn btn-success'>
          <i class='icon icon-download-alt'></i>
        </a>
      </li>
    </ul>
  </div>
</header>

<div class='container-fluid contain pad4y text-default'>

  <article class='fill-white pad4 round space-bottom4 clearfix col-sm-10 col-sm-offset-1'>
    <div class='pad2'>
      <section class='overview prose space-bottom'>
        <h4>Overview</h4>
        <%= markdown(@talk.overview) || @talk.description %>
        <div class='pad1y'>
          <span class='fill-blue dark pad0 small round inline space-bottom0'>coding</span>
          <span class='fill-blue dark pad0 small round inline space-bottom0'>magic</span>
          <span class='fill-blue dark pad0 small round inline space-bottom0'>activerecord</span>
          <span class='fill-blue dark pad0 small round inline space-bottom0'>devops</span>
          <span class='fill-blue dark pad0 small round inline space-bottom0'>databases</span>
        </div>
      </section>
      <section class='pad0y'>
        <a id='comments'></a>
        <h4><%= pluralize @comments.size, 'comment' %></h4>
        <%= render @comments %>
        <%= form_for [@talk, @comment] do |f| %>
          <div class='media pad0y'>
            <a class='media-left pad1r' href='#fakelink'>
              <%= avatar_for current_user, width: 48, class: 'img-rounded' %>
            </a>
            <div class='media-body with-input'>
              <%= f.text_area :comment, 
                              class: 'stretch space-bottom1', 
                              placeholder: 'Leave a comment, be nice...', 
                              required: true %>
              <%= f.submit 'Post comment', class: 'btn btn-primary' %>
            </div>
          </div>
        <% end %>
      </section>
    </div>
  </article>

</div>
